<h1><%= @user.name %>さんのページ</h1>

<!-- ユーザー統計情報 -->
<div class="user-stats" style="display: flex; gap: 20px; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 12px;">
  <div class="stat-card" style="flex: 1; text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div style="font-size: 2em; font-weight: bold; color: #007bff; margin-bottom: 5px;">
      <%= @user.posts.where(is_draft: false).count %>
    </div>
    <div style="color: #666; font-size: 0.9em;">投稿数</div>
  </div>
  
  <div class="stat-card" style="flex: 1; text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div style="font-size: 2em; font-weight: bold; color: #28a745; margin-bottom: 5px;">
      <%= link_to following_user_path(@user), style: "text-decoration: none; color: inherit;" do %>
        <%= @user.following.count %>
      <% end %>
    </div>
    <div style="color: #666; font-size: 0.9em;">フォロー中</div>
  </div>
  
  <div class="stat-card" style="flex: 1; text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div style="font-size: 2em; font-weight: bold; color: #dc3545; margin-bottom: 5px;">
      <%= link_to followers_user_path(@user), style: "text-decoration: none; color: inherit;" do %>
        <%= @user.followers.count %>
      <% end %>
    </div>
    <div style="color: #666; font-size: 0.9em;">フォロワー</div>
  </div>
</div>
<%= render 'follow_form' if user_signed_in? %>

<p>自己紹介: <%= @user.profile %></p>

<% if user_signed_in? && current_user == @user %>
  <%= link_to "プロフィール編集", edit_user_path(@user) %>
  <%= link_to "アカウント設定", edit_user_registration_path %>
  <%= link_to "下書き一覧", drafts_posts_path %>
<% end %>

<h2><%= @user.name %>さんの投稿</h2>
<div id="user_posts">
  <% @posts.each do |post| %>
    <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
        <h3><%= link_to post.post, post_path(post), style: "margin: 0; text-decoration: none; color: #333;" %></h3>
        <% streak_count = post.streak_count %>
        <div class="streak-badge" style="background: <%= post.recorded_on > Date.current ? '#ff9800' : (streak_count > 0 ? '#4caf50' : '#87ceeb') %>; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
          <% if post.recorded_on > Date.current %>
            ⏰ 未来の投稿
          <% elsif streak_count > 0 %>
            🔥 <%= streak_count %>日継続中
          <% else %>
            💔 うっかり
          <% end %>
        </div>
      </div>
      <p><%= post.reason %></p>
      <p>カテゴリー: <%= post.category.name if post.category %></p>
      <p>作成日: <%= l post.recorded_on, format: :japanese %></p>
      <%= render 'shared/favorite_button', post: post %>
    </div>
  <% end %>
</div>
